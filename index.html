<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lesson 10 — The Birth of Rock and Roll</title>
<style>
  :root{--bg:#0e0f12;--ink:#e8ebf0;--muted:#b6bdc9;--card:#161821;--line:#262a35;--brand:#59d0ff;--accent:#ffd166}
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 'Segoe UI',system-ui,Roboto,sans-serif}
  a {color: var(--accent);}
  body.modal-open{overflow:hidden}
  /* Hide main content until the app is ready */
  header.top, #main-content, #qna-fab {display: none;}
  .app{max-width:980px;margin:0 auto;padding:1rem}

  .slide{display:none;background:var(--card);border:1px solid var(--line);border-radius:.6rem;padding:1rem;margin:1rem 0}
  .slide:first-of-type{display:block}
  .slide-head{display:flex;align-items:baseline;justify-content:space-between;gap:.75rem;border-bottom:1px solid var(--line);padding-bottom:.4rem;margin-bottom:.6rem}
  .slide h2{margin:.2rem 0;font-size:1.4rem}
  .meter{color:var(--muted);font-size:.9rem}
  .slide-body-with-aside { display: flex; flex-wrap: wrap; gap: 1.5rem; align-items: flex-start;}
  .slide-body-main { flex: 3 1 400px; }
  .slide-body-aside { flex: 1 1 200px; }
  .slide-body-aside img { width: 100%; border-radius: .4rem; }
  .bullets{margin:.6rem 0 1rem 1.1rem}
  .bullets li{margin:.35rem 0}
  .slide-actions{display:flex; gap:.5rem; flex-wrap:wrap;}
  .read-btn,.nav-btn,.home-btn,.grade-btn{background:linear-gradient(90deg,var(--brand),#86e3ff);color:#08121f;border:0;font-weight:700;padding:.5rem .85rem;border-radius:.45rem;cursor:pointer}
  .read-btn{background:#233046;color:var(--ink);border:1px solid var(--line)}
  .full{margin:.75rem 0 .5rem 0;line-height:1.75;color:#d9e1ee}
  .keywords-list {list-style-type: none; padding-left: 0;}
  .keywords-list li { margin-bottom: .5rem; }

  .deep-list{display:flex;flex-direction:column;align-items:center;gap:.6rem;margin:1rem 0;list-style:none;padding:0}
  .deep-item{width:100%;display:flex;justify-content:center}
  .profile-btn{background:linear-gradient(90deg,var(--accent),#ffe08a);color:#08121f;border:0;font-weight:800;padding:.55rem 1rem;border-radius:.55rem;cursor:pointer;min-width:min(520px,90%);text-align:center}
  .profile-btn:hover{filter:brightness(.97)}
  .profile-btn:focus{outline:2px solid #ffd16666;outline-offset:2px}

  .slide-nav{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;margin-top:1rem;gap:.5rem}
  .home-btn{justify-self:center;background:#334055;color:var(--ink);border:1px solid var(--line)}

  .quiz-battle-container{display:flex;flex-wrap: wrap;gap:1.5rem;align-items:flex-start}
  .quiz-main{flex:1 1 60%; min-width: 300px;}
  .leaderboard{flex:1 1 35%; min-width: 280px; background:#131622;border-radius:.45rem;padding:1rem;border:1px solid var(--line)}
  .leaderboard-list li{display:flex;justify-content:space-between;padding:.4rem 0;border-bottom:1px solid var(--line);align-items:center}
  .leaderboard-list li:last-child{border-bottom:0}
  .leaderboard-list .player-name{font-size:.9em;color:var(--muted)}
  .leaderboard-list .correct-answers{font-size:.9em}
  .leaderboard-list .score{font-weight:700;color:var(--brand);font-size:1.1em}
  .quiz-question-area .q{padding:.6rem;border-bottom:1px dashed var(--line)}
  .quiz-question-area .q:last-child{border-bottom:0}
  .choices{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.35rem;margin-top:.35rem}
  .choice-btn{display:flex;gap:.5rem;align-items:center;padding:.35rem .5rem;border-radius:.35rem;background:#131622;border:1px solid var(--line);color:var(--ink);font-size:1rem;width:100%;text-align:left;cursor:pointer}
  .choice-btn.correct{border-color:rgba(6,214,160,.6);background:rgba(6,214,160,.08)}
  .choice-btn.incorrect{border-color:rgba(239,71,111,.6);background:rgba(239,71,111,.07)}
  .choice-btn:disabled{cursor:not-allowed;opacity:.7}
  .quiz-controls button{margin-top:1rem}
  #quiz-feedback{margin-top:1rem;font-weight:700}
  #quiz-timer{font-size:1.8rem;font-weight:700;color:var(--accent);text-align:center;margin-bottom:1rem;padding:.5rem;background-color:rgba(255,209,102,.1);border-radius:.45rem}

  #scrim{position:fixed;inset:0;display:none;background:rgba(0,0,0,.78);z-index:9998}
  #scrim.active{display:block}
  #modal{position:fixed;inset:0;display:none;place-items:center;z-index:9999;padding:1rem}
  #modal.active{display:grid}
  .modal-card{max-width:1100px;width:90%;background:#0f1420;border:1px solid var(--line);border-radius:.75rem;box-shadow:0 18px 60px rgba(0,0,0,.5);transform:scale(.97);opacity:0;transition:transform .2s ease,opacity .2s ease;max-height:85vh;display:flex;flex-direction:column}
  #modal.active .modal-card{transform:scale(1);opacity:1}
  .modal-head{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.2rem;border-bottom:1px solid var(--line)}
  .modal-head h3{margin:0;font-size:1.5rem}
  .modal-body{padding:1.2rem;line-height:1.85;font-size:18px;overflow-y:auto}
  .modal-body img{max-width:100%;height:auto;border-radius:.4rem;border:1px solid var(--line);margin:.6rem 0}
  .modal-body.split-layout{display:flex;gap:1.5rem;align-items:flex-start}
  .modal-body.split-layout > .modal-image-container{flex:0 0 300px;min-width:200px}
  .modal-body.split-layout img{margin:0;width:100%}
  .modal-body.split-layout > .modal-text-container{flex:1 1 auto}
  .modal-body h4{margin:1rem 0 .4rem;font-size:1rem;color:#ffe08a}
  .close{background:#2a3649;color:#e3eaf5;border:1px solid var(--line);padding:.4rem .8rem;border-radius:.45rem;cursor:pointer}

  .interactive-section{margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--line)}
  .interactive-section h3{color:var(--accent);margin-bottom:1rem}

  .poll-option{position:relative;margin-bottom:.5rem;background:#131622;border-radius:.35rem;border:1px solid var(--line);overflow:hidden}
  .poll-option button{width:100%;text-align:left;padding:.5rem .8rem .5rem 1rem;background:0 0;border:0;color:var(--ink);cursor:pointer;position:relative;z-index:2;box-sizing:border-box;padding-right:4rem;}
  .poll-option button:disabled{cursor:not-allowed}
  .poll-option.voted-for button{font-weight:700}
  .poll-option.correct-answer { background: rgba(6, 214, 160, .1) !important; border: 1px solid rgba(6, 214, 160, .7); }
  .poll-bar{position:absolute;top:0;left:0;height:100%;background:var(--brand);opacity:.2;transition:width .3s ease;z-index:1}
  .poll-percent{position:absolute;right:.8rem;top:50%;transform:translateY(-50%);font-size:.9em;font-weight:700;color:var(--ink);z-index:2}

  .build-a-band{display:flex;gap:1rem;flex-wrap:wrap}
  .instrument-pool,.band-area{flex:1;min-width:250px;padding:1rem;border:2px dashed var(--line);border-radius:.6rem}
  .band-area{background:rgba(89,208,255,.05)}
  .instrument{padding:.5rem .8rem;background:var(--card);border:1px solid var(--line);border-radius:.4rem;cursor:grab;margin-bottom:.5rem;user-select:none}
  .instrument.dragging { opacity: 0.5; }
  .band-area.drag-over{border-color:var(--brand)}
  .band-area .instrument.correct{border-left:4px solid #06d6a0}
  .band-area .instrument.incorrect{border-left:4px solid #ef476f}

  .word-cloud-container{display:flex;gap:1.5rem;flex-wrap:wrap;align-items:flex-start}
  .word-cloud-input{flex:1;min-width:250px}
  .word-cloud-display{flex:2;min-width:300px;min-height:200px;border:1px solid var(--line);border-radius:.6rem;padding:1rem;display:flex;flex-wrap:wrap;gap:.5rem 1rem;align-items:center;justify-content:center}
  .word-cloud-display span{padding:.1rem .3rem}
  .content-input-container{display:flex;gap:.5rem;margin-bottom:1rem}
  .content-input{flex-grow:1;background:#131622;border:1px solid var(--line);color:var(--ink);padding:.5rem .8rem;border-radius:.45rem;font-size:1rem}
  .add-content-btn{background:linear-gradient(90deg,var(--accent),#ffe08a);color:#08121f;border:0;font-weight:700;padding:.5rem 1rem;border-radius:.45rem;cursor:pointer}
  
  #qna-fab{position:fixed;bottom:1rem;right:1rem;z-index:100}
  #qna-panel{position:fixed;top:0;right:0;width:min(450px, 100%);height:100%;background:var(--card);border-left:1px solid var(--line);z-index:10001;transform:translateX(100%);transition:transform .3s ease}
  #qna-panel.active{transform:translateX(0)}
  .qna-head{display:flex;justify-content:space-between;align-items:center;padding:.8rem 1rem;border-bottom:1px solid var(--line)}
  .qna-body{padding:1rem;height:calc(100% - 120px);overflow-y:auto}
  .qna-footer{padding:1rem;border-top:1px solid var(--line)}
  .qna-list li{display:flex;gap:.8rem;align-items:flex-start;padding:.8rem 0;border-bottom:1px solid var(--line)}
  .qna-list li:last-child{border-bottom:0}
  .upvote-btn{display:flex;flex-direction:column;align-items:center;background:0 0;border:1px solid var(--line);color:var(--ink);border-radius:.4rem;padding:.3rem;cursor:pointer}
  .upvote-btn.voted{background:var(--brand);color:#08121f}
  .upvote-btn:disabled{cursor:not-allowed}

  .overlay{position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.85);z-index:10002;color:var(--ink)}
  .overlay.hidden{display:none}
  .overlay-card{background:var(--card);padding:2rem;border-radius:.75rem;width:min(400px, 90%);text-align:center}
  .overlay-card h3{margin-top:0;font-size:1.5rem;color:var(--accent)}
  .overlay-card input{width:100%;box-sizing:border-box;margin-bottom:1rem;text-align:center}
  .overlay-card button{width:100%;margin-bottom:.5rem}
  .overlay-card hr{border-color:var(--line);margin:1rem 0}

  /* --- New 'Sparkle' Feature Styles --- */
  .fun-facts { margin-top: 1rem; padding: 1rem; background: rgba(255, 209, 102, .05); border-left: 4px solid var(--accent); border-radius: .25rem; }
  .fun-facts p { margin: .25rem 0; }
  .fun-facts ul {padding-left: 1.2rem; margin: .5rem 0;}

  .then-vs-now { display: flex; gap: 1.5rem; flex-wrap: wrap; justify-content: center; align-items: flex-start; }
  .then-vs-now-card { flex: 1; min-width: 250px; background: #131622; border: 1px solid var(--line); padding: 1rem; border-radius: .45rem; }
  .then-vs-now-card h4 { margin-top: 0; color: var(--ink); }
  .then-vs-now-card audio { width: 100%; margin-top: .5rem; }
  .lyrics-content { white-space: pre-wrap; background: #0e0f12; padding: 1rem; border-radius: .45rem; margin-top: .5rem; }

  #build-a-verse-container { display: flex; flex-wrap: wrap; gap: 1rem; }
  .bav-col { flex: 1; min-width: 280px; }
  .bav-cloud { min-height: 150px; border: 1px solid var(--line); border-radius: .45rem; padding: .5rem; display:flex; flex-wrap:wrap; gap: .25rem .5rem; align-items:center; justify-content:center; }
  .bav-cloud span { padding: .1rem .3rem; }
  #bav-result { margin-top: 1rem; font-family: 'Courier New', Courier, monospace; background: #131622; padding: 1rem; border-radius: .45rem; white-space: pre-wrap; }
  .audio-player-container button { margin-right: .5rem;}
  
  /* --- Accessibility Additions --- */
  #accessibility-controls {
    position: fixed;
    top: .5rem;
    right: .5rem;
    z-index: 10003;
  }
  #contrast-toggle-btn {
    background: #233046;
    color: #e8ebf0;
    border: 1px solid #262a35;
    font-size: 1.2rem;
    padding: .4rem .7rem;
    border-radius: .45rem;
    cursor: pointer;
    line-height: 1;
  }
  .read-aloud-btn {
    background: #233046;
    color: #e8ebf0;
    border: 1px solid var(--line);
    padding: .3rem .6rem;
    border-radius: .45rem;
    cursor: pointer;
    font-size: .8em;
  }
  
  body.high-contrast-mode {
    --bg: #000000;
    --ink: #ffffff;
    --muted: #dddddd;
    --card: #000000;
    --line: #ffffff;
    --brand: #ffff00;
    --accent: #ffff00;
  }
  body.high-contrast-mode .profile-btn,
  body.high-contrast-mode .add-content-btn {
    background: var(--accent);
    color: #000;
    text-shadow: none;
  }
   body.high-contrast-mode a {
    color: var(--accent);
   }
   body.high-contrast-mode #contrast-toggle-btn {
    background-color: var(--bg);
    border-color: var(--line);
    color: var(--ink);
   }
</style>
</head>
<body>
  <div id="accessibility-controls">
    <button id="contrast-toggle-btn" title="Toggle High Contrast Mode">♿</button>
  </div>

  <header class="top" id="main-header">
    <div class="app brand">
      <h1>Lesson 10: The Birth of Rock and Roll</h1>
      <small>Use Next/Previous or ← → keys. Session ID: <b id="session-id-display"></b></small>
    </div>
  </header>
  <main class="app" id="main-content">
    <div id="slides" class="slides" aria-live="polite"></div>
  </main>

  <div id="scrim" aria-hidden="true"></div>
  <div id="modal" role="dialog" aria-modal="true" aria-labelledby="m-title" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-head">
        <h3 id="m-title"></h3>
        <button class="close" id="modalClose">Close ✕</button>
      </div>
      <div id="m-body" class="modal-body"></div>
    </div>
  </div>
  
  <div id="session-overlay" class="overlay hidden">
    <div class="overlay-card">
      <h3>Join a Session</h3>
      <input type="text" id="session-input" class="content-input" placeholder="ENTER SESSION ID">
      <button id="join-session-btn" class="read-btn" style="background:var(--brand);color:#08121f">Join</button>
      <hr>
      <button id="start-session-btn" class="read-btn" style="background: #06d6a0; color:#08121f">Start a New Session</button>
    </div>
  </div>

  <div id="name-entry-overlay" class="overlay hidden">
    <div class="overlay-card">
        <h3>Welcome!</h3>
        <p>Please enter your name to join the session.</p>
        <input type="text" id="name-input" class="content-input" placeholder="Your Name or Nickname" required>
        <button id="join-btn" class="add-content-btn">Join</button>
        <a href="#" id="join-anonymously" style="color: var(--muted); font-size: 0.9em; display:block; margin-top: .5rem">or join anonymously</a>
    </div>
  </div>

  <button id="qna-fab" class="profile-btn" onclick="toggleQnaPanel()">? Questions?</button>
  <div id="qna-panel">
    <div class="qna-head">
      <h3>Live Q&A</h3>
      <button class="close" onclick="toggleQnaPanel()">✕</button>
    </div>
    <div class="qna-body">
      <ul id="qna-list" class="qna-list" style="list-style: none; padding: 0;"><li>No questions yet.</li></ul>
    </div>
    <div class="qna-footer">
      <div class="content-input-container">
        <input type="text" id="qna-input" class="content-input" placeholder="Ask a question...">
        <button class="add-content-btn" onclick="submitQuestion()">Ask</button>
      </div>
    </div>
  </div>

<script type="module">
  // --- IMPORTS AND CONFIG ---
  const firebaseConfig = {
    apiKey: "AIzaSyDxpDj0axohHIFfRQ53NLWBQbf_yI2lJo0",
    authDomain: "interactive-lecture-app.firebaseapp.com",
    projectId: "interactive-lecture-app",
    storageBucket: "interactive-lecture-app.firebasestorage.app",
    messagingSenderId: "47230608512",
    appId: "1:47230608512:web:ba649a4a9ba16cef1df265",
    measurementId: "G-NDLP7MWFH9"
  };
  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, onSnapshot, doc, setDoc, getDoc, updateDoc, increment, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  
  // --- LOCAL STATE (Do not modify) ---
  let userId = null;
  let localUpvotes = new Set();
  let userName = null;
  let sessionId = null;
  let sessionDataPath = null;
  let isPresenter = false; 
  let ix = 0; 
  let slidesEls;
  let timerInterval = null;
  let timerStartTimeout = null;
  let audioContext, mainGainNode, oscillator, isPlayingBlues = false;
  
  // ==================================================================
  // --- LESSON CONTENT ---
  // ==================================================================
  
  const SLIDES = [
    {
        "id": "10.00",
        "title": "Lesson 10: The Birth of Rock and Roll",
        "headerImage": "https://i.imgur.com/UYkSNXp.png",
        "bullets": ["Watch this short video for an overview of this chapter's content."],
        "full": `<div style='position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; margin-top: 1rem;'><iframe src='https://player.vimeo.com/video/762001582?h=37c83ffa80' style='position: absolute; top: 0; left: 0; width: 100%; height: 100%;' frameborder='0' allow='fullscreen' allowfullscreen title='Chapter Synopsis Video'></iframe></div>`,
        "deep": []
    },
    {
        "id": "10.01",
        "title": "10.01 Introduction",
        "headerImage": "https://i.imgur.com/UYkSNXp.png",
        "bullets": [
            "In the early 1950s, multiple musical threads converged to create the earliest rock and roll.",
            "Artists like Ray Charles, Chuck Berry, and Fats Domino wrote and recorded some of the first crossover hits.",
            "White artists like Bill Haley and Pat Boone began covering black artists' songs, often achieving greater commercial success.",
            "Technological changes, new musical forms, and shifts in consumption patterns reshaped American popular music."
        ],
        "full": "In the early 1950s, many different musical threads came together to create the earliest rock and roll. Artists such as Ray Charles, Chuck Berry, and Fats Domino wrote and recorded some of the earliest crossover hits. Soon, white artists such as Bill Haley and the Comets and Pat Boone began recording cover versions of black artists' songs, most of which were more commercially successful than their black counterparts. Changes in technology, new and hybrid musical forms, and shifts in music consumption patterns all contributed to a reworking of the American popular music landscape that would forever alter the history of popular music consumption in the United States.",
        "deep": []
    },
    {
        "id": "10.02",
        "title": "10.02 New Technologies and Means of Consumption",
        "headerImage": "https://i.imgur.com/UYkSNXp.png",
        "asideImage": "https://omp.s3.amazonaws.com/img/img_omp10_02_WurlitzerJukebox.jpg",
         "bullets": [
            "The <b>magnetic tape recorder</b> revolutionized music recording, allowing for editing, duplication, and cheaper production.",
            "<b>45 RPM records</b> became the standard for pop singles, with each side playing for about 3-4 minutes.",
            "The <b>transistor radio</b> (developed by Bell Labs in 1947) and car radios made music more portable and accessible.",
            "<b>Top 40 radio format</b> emerged, playing the same forty songs every 24 hours with the top ten receiving the most airplay."
        ],
        "full": "The magnetic recording process changed how music was recorded and distributed. Developed by the Germans to guide radio-controlled V-2 bombs, magnetic tape allowed for sound to be recorded, erased, and re-recorded on the same tape many times, allowed for recordings to be duplicated from tape to tape, allowed for recordings to be edited, and made recording much cheaper. Recording was no longer confined to gigantic and elaborate studios owned by the major companies in a few big cities. Tolerably decent recordings could now be made anywhere by untrained personnel who knew very little about engineering or acoustics. Around the same time, high fidelity 45 RPM technology exploded onto the scene. 45 RPMs were inexpensive to produce and to purchase. It was in the world of 45 RPM singles that rhythm and blues had its first great moment in pop music history. Music listening and consumption was also affected by the radio. The transistor radio, developed by Bell Laboratory in 1947, appeared on the market in the early 1950s. About the same time, the car radio became an affordable option in the automobile industry, and people began listening to the radio in their cars as well as in their homes. By the late 1940s and early 1950s, many popular talk, drama, and comedy radio programs had moved from radio to television, and radio programmers needed to find new material to fill the airtime. Several innovations in radio programming arose, the most important of which was the development of the Top 40 radio format. Top 40 became the new radio format. The same forty songs would be repeated every 24-hour radio cycle, and the top ten songs would receive more frequent play than the bottom thirty. Why forty tunes? Because the Wurlitzer jukeboxes, which flooded the industry at the time, contained forty recordings.",
        "keywords": {
            "Magnetic tape recorder": "Recording on magnetic tape allowed for sound to be recorded, erased, and re-recorded on the same tape many times, allowed for recordings to be duplicated from tape to tape, allowed for recordings to be edited, and made recording much cheaper.",
            "45 RPM": "A record that plays at 45 revolutions per minute; had a limit of around three to four minutes per side.",
            "Top 40": "A radio format where the same forty tunes were repeated every 24-hour radio cycle, and the top ten singles received the most airplay."
        },
        "deep": [],
        "poll": {
            "q": "Which technology allowed for music to be recorded, erased, and re-recorded on the same medium?",
            "choices": ["Vinyl records", "Magnetic tape recorder", "Radio broadcasting", "CD technology"],
            "answer": 1
        }
    },
    {
        "id": "10.03",
        "title": "10.03 Alan Freed",
        "headerImage": "https://i.imgur.com/UYkSNXp.png",
        "asideImage": "https://omp.s3.amazonaws.com/blackboard/images/img_orm05_03_AlanFreed.jpg",
        "bullets": [
            "<b>Alan Freed</b> was the most influential disc jockey of early rock and roll, starting his career in Cleveland.",
            "He transformed his classical program into <i>The Moondog Show</i>, featuring rhythm and blues by black artists.",
            "Freed coined the term <b>rock and roll</b> (previously a euphemism for sex in African American music) to describe this music.",
            "He organized massive rock and roll concerts, produced movies, and hosted TV shows before his career ended due to payola scandals."
        ],
        "full": "With the rise of radio and top 40 radio, the disc jockey emerged as one of popular music's most important promoters. The most important disc jockey of the era, and indeed, one of the most important figures in the promotion of early rock and roll, was Alan Freed. Freed was the most influential disc jockey of early rock and roll. He began his radio career in 1946 in Akron, Ohio before moving to Cleveland in 1951. He soon transformed his evening classical-music program into The Moondog Show, which featured rhythm and blues records by black artists. He dubbed the music 'rock and roll'—a term used in African American music since the 1930s as a euphemism for sex—and the name stuck. The new music was a hit for teenagers, and Freed soon gained an immense radio following. In addition to champion rock and roll on the radio, Freed also organized rock and roll concerts that drew large crowd of both black and white teenagers. His success in Cleveland prompted a move to a larger market, and he began his new show, The Rock and Roll Party, on WINS in New York in 1954. Freed eventually organized a traveling concert show featuring Jerry Lee Lewis and Buddy Holly called The Big Beat, produced several rock-and-roll themed movies (including Rock Around the Clock (1956) and Don't Knock the Rock (1957)), and hosted a television show called Dance Party. His career ended on a sour note when he was the target of a Congressional investigation over receiving bribes in return for playing particular records. He was found guilty of bribery, or 'payola,' in 1962 and he died of kidney failure in 1965.",
        "keywords": {
            "Rock and roll": "Term used by Alan Freed to describe the rhythm and blues music of African American artists that he played on the radio."
        },
        "deep": [
            {
                "title": "Alan Freed (1921-1965)",
                "image": "https://omp.s3.amazonaws.com/blackboard/images/img_orm05_03_AlanFreed.jpg",
                "altText": "A photo of Alan Freed, the influential disc jockey who popularized rock and roll.",
                "bullets": [
                    "Began his radio career in 1946 in Akron, Ohio before moving to Cleveland in 1951.",
                    "Transformed his classical program into The Moondog Show, featuring rhythm and blues records by black artists.",
                    "Coined the term 'rock and roll' to describe African American popular music.",
                    "Organized massive rock and roll concerts that drew crowds of both black and white teenagers.",
                    "Produced rock-and-roll themed movies including Rock Around the Clock and Don't Knock the Rock.",
                    "His career ended due to payola scandals, being found guilty of bribery in 1962."
                ],
                "funFacts": [
                    "Freed's March 1953 concert sold 18,000 tickets for an auditorium with only 9,000 seats, leading to a riot.",
                    "By 1954, Freed was making nearly a million dollars a year from his radio show and sponsors.",
                    "He appeared in three movies: Don't Knock the Rock, Rock, Rock, Rock, and Rock Around the Clock.",
                    "Freed was listed as co-author on Chuck Berry's 'Maybellene' in exchange for promoting the record."
                ],
                "media": [
                    {"label": "Watch: Alan Freed Introduction", "href": "https://www.youtube.com/watch?v=6HblkQJ7D-c"},
                    {"label": "Listen: Alan Freed Radio Show", "href": "https://www.youtube.com/watch?v=Q9b4aZ-1X_0"},
                    {"label": "Read More: Alan Freed Biography", "href": "https://rockhall.com/inductees/alan-freed/"}
                ]
            }
        ],
        "poll": {
            "q": "What term did Alan Freed use to describe rhythm and blues music to make it more appealing to white audiences?",
            "choices": ["Pop music", "Race records", "Rock and roll", "Soul music"],
            "answer": 2
        }
    },
    {
        "id": "10.04",
        "title": "10.04 Cover Versions",
        "headerImage": "https://i.imgur.com/UYkSNXp.png",
        "bullets": [
            "White artists began releasing <b>cover versions</b> of black artists' songs to make them more appropriate for white audiences.",
            "Sexual references in original black versions were muted, modified, or deleted entirely in cover versions.",
            "<b>Pat Boone</b> exemplified the sanitized cover approach with his versions of 'Ain't That a Shame,' 'Long Tall Sally,' and 'Tutti Frutti.'",
            "<b>Bill Haley</b> was one of the first white artists to achieve commercial success with crossover versions of rhythm and blues songs."
        ],
        "full": "Teenagers may have loved rhythm and blues lyrics such as 'I got a girl named Sue, she knows just what to do' (from Little Richard's 'Tutti Frutti') and 'You're wearin those dresses, the sun comes shinin' through / I can't believe my eyes, all of this belongs to you' (from Big Joe Turner's 'Shake, Rattle, and Roll'), but parents, record companies, and radio stations were less than impressed. In response, white artists and record companies began releasing cover versions of black artists' songs. In general, a cover version refers to a song that is re-recorded by another artist. During the age of early rock and roll, however, these cover versions had a very specific purpose: to modify black artists' rhythm and blues songs in order to make them more appropriate for white audiences. The sexual references in the original black version were muted, modified, or deleted entirely. Recordings by the squeaky-clean white singer Pat Boone exemplify the goals of early cover versions. Boone's covers of 'Ain't That a Shame' (originally by Fats Domino), 'Long Tall Sally' (originally by Little Richard), and 'Tutti Frutti' (originally by Little Richard) are all more subdued and less sexually suggestive than the originals. Bill Haley was one of the first white artists to achieve commercial success with crossover versions of rhythm and blues songs. His version of 'Shake, Rattle, and Roll' (originally by Big Joe Turner) is a perfect example of a cover version. Haley's version removes the sexual references in Turner's version and replaces them with more innocent lyrics.",
        "keywords": {
            "Cover version": "A song that is re-recorded by another artist; in the early rock and roll era, these were often sanitized versions of black artists' songs intended for white audiences."
        },
        "deep": [
            {
                "title": "Pat Boone (b. 1934)",
                "image": "https://i.imgur.com/2x3J4zW.jpg",
                "altText": "A photo of Pat Boone, the clean-cut singer known for his cover versions of rock and roll songs.",
                "bullets": [
                    "Became one of the most successful recording artists of the late 1950s with his sanitized cover versions.",
                    "His cover of Fats Domino's 'Ain't That a Shame' reached #1 on the pop charts in 1955.",
                    "Also covered Little Richard's 'Tutti Frutti' and 'Long Tall Sally', removing the suggestive lyrics.",
                    "Presented a clean-cut, wholesome image that appealed to white middle-class families.",
                    "Sold over 45 million records, had 38 Top 40 hits, and appeared in more than 12 Hollywood movies."
                ],
                "funFacts": [
                    "Pat Boone attended David Lipscomb College in Nashville and was known for his conservative values.",
                    "He wore white buck shoes as his trademark, which became a fashion trend among teenagers.",
                    "Despite covering rock and roll songs, Boone personally disapproved of the genre's wilder aspects.",
                    "In 1997, he released an album of heavy metal covers called 'In a Metal Mood: No More Mr. Nice Guy'."
                ],
                "media": [
                    {"label": "Listen: Pat Boone's 'Ain't That a Shame'", "href": "https://www.youtube.com/watch?v=JzY7k3jC8c0"},
                    {"label": "Compare: Pat Boone vs. Little Richard", "href": "https://www.youtube.com/watch?v=0vLm6aTWbWE"},
                    {"label": "Read More: Pat Boone Biography", "href": "https://www.britannica.com/biography/Pat-Boone"}
                ]
            },
            {
                "title": "Bill Haley (1925-1981)",
                "image": "https://i.imgur.com/5Q7V8t9.jpg",
                "altText": "A photo of Bill Haley, leader of Bill Haley & His Comets, one of the first white rock and roll bands.",
                "bullets": [
                    "Leader of Bill Haley & His Comets, one of the first white rock and roll bands to achieve commercial success.",
                    "His 1954 recording of 'Rock Around the Clock' became one of the best-selling singles of all time.",
                    "Covered Big Joe Turner's 'Shake, Rattle, and Roll', removing the sexual references from the original.",
                    "Developed a distinctive sound by combining country-western instrumentation with rhythm and blues.",
                    "Appeared in several of the earliest rock and roll films, helping to popularize the genre."
                ],
                "funFacts": [
                    "Bill Haley was originally a country and western singer before transitioning to rock and roll.",
                    "'Rock Around the Clock' was originally a B-side until it was featured in the film 'Blackboard Jungle'.",
                    "Haley's band featured a stand-up bass that was slapped and spun during performances.",
                    "He continued performing internationally until his health declined in the late 1970s."
                ],
                "media": [
                    {"label": "Watch: 'Rock Around the Clock'", "href": "https://www.youtube.com/watch?v=ZgdufzXvjqw"},
                    {"label": "Listen: 'Shake, Rattle and Roll'", "href": "https://www.youtube.com/watch?v=amJgqoK__Cw"},
                    {"label": "Read More: Bill Haley Biography", "href": "https://rockhall.com/inductees/bill-haley/"}
                ]
            }
        ],
        "poll": {
            "q": "What was the primary purpose of cover versions in the early rock and roll era?",
            "choices": ["To improve the musical quality of songs", "To make black artists' songs more appropriate for white audiences", "To create longer versions of popular songs", "To combine multiple songs into medleys"],
            "answer": 1
        }
    },
    {
        "id": "10.09",
        "title": "10.09 Elvis Presley",
        "headerImage": "https://i.imgur.com/UYkSNXp.png",
        "asideImage": "https://i.imgur.com/8N0v9hx.jpg",
        "bullets": [
            "<b>Elvis Presley</b> was the most successful artist of the early rock and roll era, selling over one billion records worldwide.",
            "He combined elements of country, gospel, and rhythm and blues to create his distinctive sound.",
            "Presley's controversial hip-shaking performances on television generated both massive popularity and moral outrage.",
            "His career spanned music, film, and television, making him one of the most influential cultural figures of the 20th century."
        ],
        "full": "Elvis Presley was the most successful artist of the early rock and roll era. He has sold over one billion records worldwide, more than any other artist in the history of the recording industry. Presley combined elements of country, gospel, and rhythm and blues to create his distinctive sound. His first recordings for Sun Records in Memphis, Tennessee, were covers of rhythm and blues songs such as Arthur 'Big Boy' Crudup's 'That's All Right' and Roy Brown's 'Good Rockin' Tonight.' Presley's controversial hip-shaking performances on television generated both massive popularity and moral outrage. His appearances on The Ed Sullivan Show drew record-breaking audiences, though the camera was often directed only from the waist up to avoid showing his suggestive dance moves. Presley's career spanned music, film, and television, making him one of the most influential cultural figures of the 20th century. He starred in 31 feature films and made numerous television appearances, though his later years were marked by personal struggles and health issues. Despite his death in 1977, Elvis Presley remains an enduring icon of American popular culture.",
        "keywords": {
            "Elvis Presley": "The most successful artist of the early rock and roll era, known for combining country, gospel, and rhythm and blues influences."
        },
        "deep": [
            {
                "title": "Elvis Presley (1935-1977)",
                "image": "https://i.imgur.com/8N0v9hx.jpg",
                "altText": "A photo of Elvis Presley, the King of Rock and Roll, during his peak performance years.",
                "bullets": [
                    "Born in Tupelo, Mississippi, and raised in Memphis, Tennessee.",
                    "Discovered by Sun Records owner Sam Phillips in 1954.",
                    "His first hit, 'Heartbreak Hotel' (1956), sold over one million copies.",
                    "Appeared on The Ed Sullivan Show in 1956, drawing approximately 60 million viewers.",
                    "Served in the U.S. Army from 1958 to 1960, pausing his music career.",
                    "Starred in 31 feature films throughout the 1960s.",
                    "Made a celebrated comeback with a 1968 television special.",
                    "Died at his Graceland home in Memphis in 1977 at age 42."
                ],
                "funFacts": [
                    "Elvis never performed outside of North America, with the exception of three shows in Canada in 1957.",
                    "He received 14 Grammy nominations, winning three for his gospel recordings.",
                    "Presley had 18 number-one hits on the Billboard charts during his career.",
                    "His home, Graceland, is the second most-visited private home in America after the White House.",
                    "Elvis was known for giving away cars and jewelry to friends and strangers alike."
                ],
                "media": [
                    {"label": "Watch: 1968 Comeback Special", "href": "https://www.youtube.com/watch?v=tNixoCBKq6s"},
                    {"label": "Listen: Sun Sessions", "href": "https://www.youtube.com/watch?v=u9dRgQyZvb0"},
                    {"label": "Visit: Graceland Virtual Tour", "href": "https://www.graceland.com/"},
                    {"label": "Read More: Elvis Presley Biography", "href": "https://rockhall.com/inductees/elvis-presley/"}
                ]
            }
        ],
        "poll": {
            "q": "Which musical styles did Elvis Presley combine to create his distinctive sound?",
            "choices": ["Jazz, classical, and folk", "Country, gospel, and rhythm and blues", "Opera, blues, and disco", "Reggae, soul, and funk"],
            "answer": 1
        }
    },
    {
        "id": "10.10",
        "title": "10.10 The Day the Music Died",
        "headerImage": "https://i.imgur.com/UYkSNXp.png",
        "bullets": [
            "The deaths of <b>Buddy Holly</b>, <b>Ritchie Valens</b>, and <b>The Big Bopper</b> in a 1959 plane crash marked a symbolic end to rock's first era.",
            "The tragedy was immortalized in Don McLean's 1971 song 'American Pie' as 'the day the music died.'",
            "This event coincided with other challenges to early rock and roll, including the payola scandal and Elvis's induction into the army.",
            "The early 1960s saw a temporary shift toward cleaner, more manufactured pop before the British Invasion revitalized rock music."
        ],
        "full": "February 3, 1959, is often referred to as 'the day the music died,' following the deaths of Buddy Holly, Ritchie Valens, and The Big Bopper (J.P. Richardson) in a plane crash. The three artists were touring together as part of the 'Winter Dance Party' tour across the Midwest. After a performance in Clear Lake, Iowa, Holly chartered a small plane to fly to the next tour stop in Moorhead, Minnesota. The plane crashed shortly after takeoff in poor weather conditions, killing all three musicians and the pilot. The tragedy was immortalized in Don McLean's 1971 song 'American Pie' as 'the day the music died.' This event coincided with other challenges to early rock and roll, including the payola scandal that ended Alan Freed's career and Elvis Presley's induction into the U.S. Army in 1958. The early 1960s saw a temporary shift toward cleaner, more manufactured pop before the British Invasion revitalized rock music in 1964. Despite their short careers, Holly, Valens, and The Big Bopper left lasting impacts on rock and roll, influencing countless musicians who followed.",
        "keywords": {
            "The Day the Music Died": "February 3, 1959, when Buddy Holly, Ritchie Valens, and The Big Bopper died in a plane crash, symbolizing the end of rock's first era."
        },
        "deep": [
            {
                "title": "Buddy Holly (1936-1959)",
                "image": "https://i.imgur.com/9zLp7qK.jpg",
                "altText": "A photo of Buddy Holly, the influential rock and roll pioneer known for his distinctive glasses and songwriting.",
                "bullets": [
                    "Born Charles Hardin Holley in Lubbock, Texas.",
                    "Pioneered the standard rock band lineup of two guitars, bass, and drums.",
                    "Wrote and recorded classics like 'Peggy Sue,' 'That'll Be the Day,' and 'Oh, Boy!'",
                    "Innovated recording techniques including double-tracking vocals.",
                    "Influenced countless musicians including The Beatles (who named themselves in homage to Holly's band The Crickets)."
                ],
                "funFacts": [
                    "Holly's distinctive eyeglasses became his trademark and inspired later musicians like Elvis Costello.",
                    "He married Maria Elena Santiago just months before his death.",
                    "In his short 18-month recording career, he recorded over 50 songs.",
                    "John Lennon once said, 'Buddy Holly was the first one that we were aware of in England who could play and sing at the same time.'"
                ],
                "media": [
                    {"label": "Listen: 'That'll Be the Day'", "href": "https://www.youtube.com/watch?v=pcxqeLzByeA"},
                    {"label": "Watch: Buddy Holly Performance", "href": "https://www.youtube.com/watch?v=4NnhP8Fw6C0"},
                    {"label": "Read More: Buddy Holly Biography", "href": "https://rockhall.com/inductees/buddy-holly/"}
                ]
            },
            {
                "title": "Ritchie Valens (1941-1959)",
                "image": "https://i.imgur.com/3M8V2tT.jpg",
                "altText": "A photo of Ritchie Valens, the pioneering Latino rock and roll star.",
                "bullets": [
                    "Born Richard Valenzuela in Pacoima, California.",
                    "One of the first musicians of Mexican descent to achieve mainstream success in American rock.",
                    "His hit 'La Bamba' adapted a traditional Mexican folk song into a rock and roll style.",
                    "Had a number-two hit with 'Donna,' written for his high school girlfriend.",
                    "Career lasted only eight months before his death at age 17."
                ],
                "funFacts": [
                    "Valens learned to play guitar left-handed without restringing the instrument.",
                    "He was afraid of flying due to a childhood friend who died in a plane crash.",
                    "The coin toss that gave Valens the seat on the plane instead of Waylon Jennings became legendary.",
                    "His life was portrayed in the 1987 film 'La Bamba' starring Lou Diamond Phillips."
                ],
                "media": [
                    {"label": "Listen: 'La Bamba'", "href": "https://www.youtube.com/watch?v=Jp6j5HJ-Cok"},
                    {"label": "Watch: Ritchie Valens Performance", "href": "https://www.youtube.com/watch?v=9LpKQQvAJdY"},
                    {"label": "Read More: Ritchie Valens Biography", "href": "https://www.britannica.com/biography/Ritchie-Valens"}
                ]
            },
            {
                "title": "The Big Bopper (1930-1959)",
                "image": "https://i.imgur.com/5D6Qk9L.jpg",
                "altText": "A photo of The Big Bopper (J.P. Richardson), known for his novelty rock and roll hits.",
                "bullets": [
                    "Born Jiles Perry Richardson Jr. in Sabine Pass, Texas.",
                    "Worked as a disc jockey before becoming a recording artist.",
                    "His hit 'Chantilly Lace' sold over six million copies.",
                    "Wrote 'White Lightning' which became a hit for George Jones.",
                    "At 28, he was the oldest of the three artists who died in the plane crash."
                ],
                "funFacts": [
                    "He got his nickname 'The Big Bopper' from his radio persona.",
                    "Set a world record for continuous broadcasting by playing records for five days, two hours, and eight minutes.",
                    "Was married with a daughter, and his wife was pregnant with their second child at the time of his death.",
                    "His son, Jay Perry Richardson, later performed tribute shows as The Big Bopper Jr."
                ],
                "media": [
                    {"label": "Listen: 'Chantilly Lace'", "href": "https://www.youtube.com/watch?v=ONkf0g5nI0k"},
                    {"label": "Watch: The Big Bopper Performance", "href": "https://www.youtube.com/watch?v=4pRhyaH6f6Y"},
                    {"label": "Read More: The Big Bopper Biography", "href": "https://www.britannica.com/biography/the-Big-Bopper"}
                ]
            }
        ],
        "poll": {
            "q": "Which event is referred to as 'the day the music died'?",
            "choices": ["Elvis Presley's induction into the army", "The payola scandal that ended Alan Freed's career", "The plane crash that killed Buddy Holly, Ritchie Valens, and The Big Bopper", "The British Invasion of 1964"],
            "answer": 2
        }
    },
    {
        "id": "10.11",
        "title": "10.11 Conclusion",
        "headerImage": "https://i.imgur.com/UYkSNXp.png",
        "bullets": [
            "Rock and roll emerged from the convergence of multiple musical traditions, technological innovations, and social changes.",
            "The genre faced significant resistance from established interests but ultimately transformed American popular culture.",
            "Early rock and roll established patterns of racial crossover and cultural appropriation that continue to influence popular music.",
            "Despite challenges, the music of this era laid the foundation for all subsequent developments in rock music."
        ],
        "full": "Rock and roll emerged in the 1950s from the convergence of multiple musical traditions, technological innovations, and social changes. The genre represented a fusion of rhythm and blues, country, gospel, and other styles that appealed particularly to the emerging teenage market. The music faced significant resistance from established interests including record companies, radio stations, and moral guardians who saw it as a threat to social order. Despite this opposition, rock and roll ultimately transformed American popular culture, breaking down racial barriers in music consumption and establishing youth culture as a powerful economic force. Early rock and roll established patterns of racial crossover and cultural appropriation that continue to influence popular music, with white artists often achieving greater commercial success with sanitized versions of black musical innovations. The payola scandals, the induction of Elvis into the army, and the deaths of key figures in 1959 marked the end of rock's first era. However, the music of this period laid the foundation for all subsequent developments in rock music, influencing the British Invasion, the counterculture movements of the 1960s, and virtually every popular music genre that followed.",
        "deep": [],
        "interactive": {
            "type": "wordCloud",
            "title": "Key Concepts in Early Rock and Roll",
            "prompt": "What words or phrases come to mind when you think about the birth of rock and roll?",
            "placeholder": "Enter a term (e.g., 45 RPM, cover version, payola...)",
            "initialWords": ["Rock and roll", "Rhythm and blues", "Cover versions", "Alan Freed", "Elvis Presley", "45 RPM", "Payola", "Teenagers", "Radio", "Jukebox", "Race records", "Crossover", "Bill Haley", "Pat Boone", "Little Richard", "Chuck Berry", "Fats Domino", "Buddy Holly"]
        }
    },
    {
        "id": "10.quiz",
        "title": "Chapter 10 Review Quiz",
        "headerImage": "https://i.imgur.com/UYkSNXp.png",
        "bullets": [
            "Test your knowledge of Chapter 10 concepts with this interactive quiz.",
            "Answer all questions before time runs out!",
            "Your score will be displayed on the leaderboard alongside other participants."
        ],
        "quiz": {
            "timeLimit": 300,
            "questions": [
                {
                    "q": "What technology allowed for sound to be recorded, erased, and re-recorded on the same medium?",
                    "choices": ["Vinyl records", "Magnetic tape recorder", "Radio broadcasting", "CD technology"],
                    "answer": 1
                },
                {
                    "q": "What did the term 'rock and roll' originally refer to in African American music?",
                    "choices": ["A style of dancing", "A type of guitar technique", "A euphemism for sex", "A religious celebration"],
                    "answer": 2
                },
                {
                    "q": "What was the primary purpose of cover versions in the early rock and roll era?",
                    "choices": ["To improve the musical quality of songs", "To make black artists' songs more appropriate for white audiences", "To create longer versions of popular songs", "To combine multiple songs into medleys"],
                    "answer": 1
                },
                {
                    "q": "Which artist was known for his sanitized cover versions of rock and roll songs?",
                    "choices": ["Little Richard", "Chuck Berry", "Pat Boone", "Fats Domino"],
                    "answer": 2
                },
                {
                    "q": "What event is referred to as 'the day the music died'?",
                    "choices": ["Elvis Presley's induction into the army", "The payola scandal that ended Alan Freed's career", "The plane crash that killed Buddy Holly, Ritchie Valens, and The Big Bopper", "The British Invasion of 1964"],
                    "answer": 2
                },
                {
                    "q": "Which musical styles did Elvis Presley combine to create his distinctive sound?",
                    "choices": ["Jazz, classical, and folk", "Country, gospel, and rhythm and blues", "Opera, blues, and disco", "Reggae, soul, and funk"],
                    "answer": 1
                },
                {
                    "q": "What radio format played the same forty songs every 24 hours?",
                    "choices": ["Freeform", "Top 40", "Album-oriented rock", "Talk radio"],
                    "answer": 1
                },
                {
                    "q": "Which disc jockey coined the term 'rock and roll' for the new music?",
                    "choices": ["Wolfman Jack", "Casey Kasem", "Alan Freed", "Dick Clark"],
                    "answer": 2
                },
                {
                    "q": "What was the name of Alan Freed's radio show in Cleveland?",
                    "choices": ["The Rock and Roll Party", "The Moondog Show", "The Big Beat", "Dance Party"],
                    "answer": 1
                },
                {
                    "q": "Which of these was NOT a factor in the decline of early rock and roll?",
                    "choices": ["The payola scandal", "Elvis Presley's army induction", "The British Invasion", "The deaths of Buddy Holly, Ritchie Valens, and The Big Bopper"],
                    "answer": 2
                }
            ]
        }
    }
  ];
  
  // ==================================================================
  // --- END OF LESSON CONTENT ---
  // ==================================================================
  
  // --- FIREBASE AUTH AND INITIALIZATION ---
  async function initializeAuth() {
    try {
      if (initialAuthToken) {
        await signInWithCustomToken(auth, initialAuthToken);
      } else {
        await signInAnonymously(auth);
      }
    } catch (error) {
      console.error("Authentication error:", error);
      await signInAnonymously(auth);
    }
  }
  
  // --- SESSION MANAGEMENT ---
  function generateSessionId() {
    return Math.random().toString(36).substring(2, 8).toUpperCase();
  }
  
  async function joinSession(sessionIdToJoin, userName) {
    sessionId = sessionIdToJoin.toUpperCase();
    sessionDataPath = `sessions/${sessionId}`;
    document.getElementById('session-id-display').textContent = sessionId;
    
    const sessionDoc = doc(db, sessionDataPath);
    const sessionSnap = await getDoc(sessionDoc);
    
    if (!sessionSnap.exists()) {
      alert("Session not found. Please check the session ID and try again.");
      return false;
    }
    
    await setDoc(doc(db, `${sessionDataPath}/participants`, userId), {
      name: userName || "Anonymous",
      joinedAt: new Date(),
      lastSeen: new Date()
    });
    
    localStorage.setItem('userName', userName || "Anonymous");
    localStorage.setItem('sessionId', sessionId);
    
    return true;
  }
  
  async function startNewSession() {
    sessionId = generateSessionId();
    sessionDataPath = `sessions/${sessionId}`;
    isPresenter = true;
    
    await setDoc(doc(db, sessionDataPath), {
      createdAt: new Date(),
      createdBy: userId,
      currentSlide: 0,
      status: 'active'
    });
    
    document.getElementById('session-id-display').textContent = sessionId;
    localStorage.setItem('sessionId', sessionId);
    localStorage.setItem('isPresenter', 'true');
    
    showMainUI();
  }
  
  // --- UI MANAGEMENT ---
  function showMainUI() {
    document.querySelectorAll('.overlay').forEach(el => el.classList.add('hidden'));
    document.querySelector('header.top').style.display = 'block';
    document.getElementById('main-content').style.display = 'block';
    document.getElementById('qna-fab').style.display = 'block';
    renderSlides();
    if (isPresenter) setupPresenterControls();
    setupRealtimeListeners();
  }
  
  function renderSlides() {
    const slidesContainer = document.getElementById('slides');
    slidesContainer.innerHTML = '';
    
    SLIDES.forEach((slide, index) => {
      const slideEl = document.createElement('div');
      slideEl.className = 'slide';
      slideEl.id = `slide-${slide.id}`;
      
      let asideContent = '';
      if (slide.asideImage) {
        asideContent = `<div class="slide-body-aside"><img src="${slide.asideImage}" alt="Related image for ${slide.title}"></div>`;
      }
      
      let bulletsContent = '';
      if (slide.bullets && slide.bullets.length) {
        bulletsContent = `<ul class="bullets">${slide.bullets.map(b => `<li>${b}</li>`).join('')}</ul>`;
      }
      
      let fullContent = '';
      if (slide.full) {
        fullContent = `<div class="full">${slide.full}</div>`;
      }
      
      let deepDivesContent = '';
      if (slide.deep && slide.deep.length) {
        deepDivesContent = `
          <ul class="deep-list">
            ${slide.deep.map(item => `
              <li class="deep-item">
                <button class="profile-btn" onclick="openModal('${item.title}', ${JSON.stringify(item).replace(/'/g, "\\'")})">
                  ${item.title}
                </button>
              </li>
            `).join('')}
          </ul>
        `;
      }
      
      let pollContent = '';
      if (slide.poll) {
        pollContent = `
          <div class="interactive-section">
            <h3>Quick Poll</h3>
            <p>${slide.poll.q}</p>
            <div class="poll-options">
              ${slide.poll.choices.map((choice, i) => `
                <div class="poll-option">
                  <button onclick="voteOnPoll(${index}, ${i})">${choice}</button>
                  <div class="poll-bar" style="width: 0%"></div>
                  <span class="poll-percent">0%</span>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
      
      let quizContent = '';
      if (slide.quiz) {
        quizContent = `
          <div class="interactive-section">
            <h3>Quiz Battle</h3>
            <div class="quiz-battle-container">
              <div class="quiz-main">
                <div id="quiz-timer">${formatTime(slide.quiz.timeLimit)}</div>
                <div id="quiz-questions">
                  ${slide.quiz.questions.map((q, qIndex) => `
                    <div class="q" id="quiz-q-${qIndex}">
                      <p><b>${qIndex + 1}.</b> ${q.q}</p>
                      <div class="choices">
                        ${q.choices.map((choice, cIndex) => `
                          <button class="choice-btn" onclick="answerQuizQuestion(${qIndex}, ${cIndex})">
                            ${String.fromCharCode(65 + cIndex)}. ${choice}
                          </button>
                        `).join('')}
                      </div>
                    </div>
                  `).join('')}
                </div>
                <div id="quiz-feedback"></div>
                <button class="grade-btn" onclick="gradeQuiz()" style="display:none">Grade Quiz</button>
              </div>
              <div class="leaderboard">
                <h4>Leaderboard</h4>
                <ul class="leaderboard-list" id="quiz-leaderboard">
                  <li>No scores yet</li>
                </ul>
              </div>
            </div>
          </div>
        `;
      }
      
      let interactiveContent = '';
      if (slide.interactive) {
        if (slide.interactive.type === 'wordCloud') {
          interactiveContent = `
            <div class="interactive-section">
              <h3>${slide.interactive.title}</h3>
              <p>${slide.interactive.prompt}</p>
              <div class="word-cloud-container">
                <div class="word-cloud-input">
                  <div class="content-input-container">
                    <input type="text" id="word-input" class="content-input" placeholder="${slide.interactive.placeholder}">
                    <button class="add-content-btn" onclick="addWordToCloud()">Add</button>
                  </div>
                  <div id="submitted-words"></div>
                </div>
                <div class="word-cloud-display" id="word-cloud">
                  ${slide.interactive.initialWords.map(word => `<span style="font-size: ${14 + Math.random() * 20}px">${word}</span>`).join('')}
                </div>
              </div>
            </div>
          `;
        }
      }
      
      slideEl.innerHTML = `
        <div class="slide-head">
          <h2>${slide.title}</h2>
          <span class="meter">${index + 1} of ${SLIDES.length}</span>
        </div>
        ${slide.headerImage ? `<img src="${slide.headerImage}" alt="Header image" style="width:100%; border-radius:.4rem; margin-bottom:1rem;">` : ''}
        <div class="slide-body-with-aside">
          <div class="slide-body-main">
            ${bulletsContent}
            ${fullContent}
            ${deepDivesContent}
            ${pollContent}
            ${quizContent}
            ${interactiveContent}
          </div>
          ${asideContent}
        </div>
        <div class="slide-nav">
          <button class="nav-btn" onclick="navigateSlide(${index - 1})" ${index === 0 ? 'disabled' : ''}>← Previous</button>
          <button class="home-btn" onclick="navigateSlide(0)">Home</button>
          <button class="nav-btn" onclick="navigateSlide(${index + 1})" ${index === SLIDES.length - 1 ? 'disabled' : ''}>Next →</button>
        </div>
      `;
      
      slidesContainer.appendChild(slideEl);
    });
    
    slidesEls = document.querySelectorAll('.slide');
    navigateSlide(0);
  }
  
  function navigateSlide(newIndex) {
    if (newIndex < 0 || newIndex >= slidesEls.length) return;
    
    slidesEls[ix].style.display = 'none';
    ix = newIndex;
    slidesEls[ix].style.display = 'block';
    
    if (isPresenter) {
      updateSessionSlide(ix);
    }
  }
  
  function setupPresenterControls() {
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') navigateSlide(ix - 1);
      if (e.key === 'ArrowRight') navigateSlide(ix + 1);
    });
  }
  
  // --- REAL-TIME UPDATES ---
  function setupRealtimeListeners() {
    // Listen for slide changes
    if (!isPresenter) {
      const sessionDoc = doc(db, sessionDataPath);
      onSnapshot(sessionDoc, (doc) => {
        if (doc.exists()) {
          const data = doc.data();
          if (data.currentSlide !== undefined && data.currentSlide !== ix) {
            navigateSlide(data.currentSlide);
          }
        }
      });
    }
    
    // Listen for Q&A updates
    const qnaQuery = query(collection(db, `${sessionDataPath}/qna`), orderBy('timestamp', 'desc'));
    onSnapshot(qnaQuery, (snapshot) => {
      const qnaList = document.getElementById('qna-list');
      qnaList.innerHTML = '';
      
      if (snapshot.empty) {
        qnaList.innerHTML = '<li>No questions yet.</li>';
        return;
      }
      
      snapshot.forEach((doc) => {
        const data = doc.data();
        const li = document.createElement('li');
        
        li.innerHTML = `
          <button class="upvote-btn ${localUpvotes.has(doc.id) ? 'voted' : ''}" 
                  onclick="upvoteQuestion('${doc.id}')" 
                  ${localUpvotes.has(doc.id) ? 'disabled' : ''}>
            <span>▲</span>
            <span>${data.upvotes || 0}</span>
          </button>
          <div>
            <strong>${data.author}:</strong> ${data.text}
          </div>
        `;
        
        qnaList.appendChild(li);
      });
    });
    
    // Listen for poll updates
    SLIDES.forEach((slide, index) => {
      if (slide.poll) {
        const pollRef = collection(db, `${sessionDataPath}/polls/${index}/votes`);
        onSnapshot(pollRef, (snapshot) => {
          if (snapshot.empty) return;
          
          const votes = Array(slide.poll.choices.length).fill(0);
          snapshot.forEach((doc) => {
            const data = doc.data();
            votes[data.choice]++;
          });
          
          const totalVotes = votes.reduce((sum, count) => sum + count, 0);
          
          const pollOptions = document.querySelectorAll(`#slide-${slide.id} .poll-option`);
          pollOptions.forEach((option, i) => {
            const percent = totalVotes > 0 ? Math.round((votes[i] / totalVotes) * 100) : 0;
            option.querySelector('.poll-bar').style.width = `${percent}%`;
            option.querySelector('.poll-percent').textContent = `${percent}%`;
          });
        });
      }
    });
  }
  
  // --- INTERACTIVE FEATURES ---
  async function voteOnPoll(slideIndex, choiceIndex) {
    if (!sessionDataPath) return;
    
    const voteDoc = doc(db, `${sessionDataPath}/polls/${slideIndex}/votes`, userId);
    await setDoc(voteDoc, {
      choice: choiceIndex,
      votedAt: new Date()
    });
  }
  
  async function submitQuestion() {
    const input = document.getElementById('qna-input');
    const text = input.value.trim();
    
    if (!text || !sessionDataPath) return;
    
    await addDoc(collection(db, `${sessionDataPath}/qna`), {
      text: text,
      author: userName || "Anonymous",
      timestamp: new Date(),
      upvotes: 0
    });
    
    input.value = '';
  }
  
  async function upvoteQuestion(questionId) {
    if (localUpvotes.has(questionId)) return;
    
    const questionRef = doc(db, `${sessionDataPath}/qna`, questionId);
    await updateDoc(questionRef, {
      upvotes: increment(1)
    });
    
    localUpvotes.add(questionId);
  }
  
  function toggleQnaPanel() {
    document.getElementById('qna-panel').classList.toggle('active');
  }
  
  // --- MODAL FUNCTIONS ---
  function openModal(title, content) {
    document.getElementById('scrim').classList.add('active');
    document.getElementById('modal').classList.add('active');
    document.getElementById('m-title').textContent = title;
    
    let modalBody = '';
    
    if (content.image) {
      modalBody += `<div class="modal-body split-layout">
        <div class="modal-image-container"><img src="${content.image}" alt="${content.altText || ''}"></div>
        <div class="modal-text-container">`;
    }
    
    if (content.bullets && content.bullets.length) {
      modalBody += `<ul class="bullets">${content.bullets.map(b => `<li>${b}</li>`).join('')}</ul>`;
    }
    
    if (content.funFacts && content.funFacts.length
